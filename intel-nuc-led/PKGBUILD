# Forked from https://github.com/milesp20/intel_nuc_led/, which is not maintained

developer="https://indiecomputing.com/"
url="https://github.com/uboslinux/ubos-devices"
maintainer=${developer}
pkgname=$(basename $(pwd))
pkgver=0.y
pkgrel=10
pkgdesc='Intel NUC7i[x]BN and NUC6CAY LED Control for Linux '
arch=('x86_64')
license=('GPL3')
_kernelver=5.8.1.arch1-1
_kernelpath=5.8.1-arch1-1
# Note: not the same: hyphen vs dot
depends=("linux=${_kernelver}")
makedepends=("linux-headers=${_kernelver}")
source=(
    "Makefile"
    "nuc_led.c"
)
sha512sums=(
    'SKIP'
    'SKIP'
)

build() {
    cd origin
    make KVERSION="$(uname -r)" default
}

package() {
    install -m644 origin/nuc_led.ko -Dt "${pkgdir}/usr/lib/modules/${_kernelpath}/extramodules/"
    find "${pkgdir}" -name '*.ko' -exec gzip -n {} +

    echo nuc_led | install -Dm644 /dev/stdin "${pkgdir}/usr/lib/modules-load.d/nuc_led.conf"
}
